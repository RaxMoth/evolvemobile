[gd_scene load_steps=10 format=3 uid="uid://cnmv786k3qi1c"]

[ext_resource type="Script" uid="uid://blo8rclfc3t6r" path="res://Scenes/NPCs/npc_base_class.gd" id="1_517tc"]
[ext_resource type="Texture2D" uid="uid://b8hlhq44dx3qv" path="res://icon.svg" id="2_okm3t"]
[ext_resource type="Script" uid="uid://couw105c3bde4" path="res://addons/godot_state_charts/state_chart.gd" id="3_u53yq"]
[ext_resource type="Script" uid="uid://jk2jm1g6q853" path="res://addons/godot_state_charts/compound_state.gd" id="4_wcc3o"]
[ext_resource type="Script" uid="uid://cytafq8i1y8qm" path="res://addons/godot_state_charts/atomic_state.gd" id="5_4yoai"]
[ext_resource type="Script" uid="uid://cf1nsco3w0mf6" path="res://addons/godot_state_charts/transition.gd" id="6_1wtkv"]

[sub_resource type="LabelSettings" id="LabelSettings_o028b"]
font_size = 18

[sub_resource type="CircleShape2D" id="CircleShape2D_50nec"]
radius = 172.01163

[sub_resource type="CircleShape2D" id="CircleShape2D_o028b"]
radius = 31.06445

[node name="Npc" type="Node2D"]
script = ExtResource("1_517tc")

[node name="Control" type="Control" parent="."]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_top = -47.0
offset_right = 84.0
offset_bottom = -34.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="HBoxContainer" type="HBoxContainer" parent="Control"]
layout_mode = 1
anchors_preset = -1
anchor_left = -0.5
anchor_top = -1.2307693
anchor_right = 0.5
anchor_bottom = 0.7692308
grow_horizontal = 2
grow_vertical = 2
metadata/_edit_use_anchors_ = true

[node name="HealthBar" type="ProgressBar" parent="Control/HBoxContainer"]
unique_name_in_owner = true
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 4
show_percentage = false

[node name="LVLabel" type="Label" parent="Control/HBoxContainer"]
unique_name_in_owner = true
layout_mode = 2
size_flags_horizontal = 3
text = "1"
label_settings = SubResource("LabelSettings_o028b")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
scale = Vector2(1, 0.99999994)

[node name="Sprite2D" type="Sprite2D" parent="."]
rotation = -0.0119461
scale = Vector2(0.602, 0.5)
texture = ExtResource("2_okm3t")

[node name="DetectionArea" type="Area2D" parent="."]
unique_name_in_owner = true
visible = false
collision_layer = 3
collision_mask = 3

[node name="CollisionShape2D" type="CollisionShape2D" parent="DetectionArea"]
shape = SubResource("CircleShape2D_50nec")

[node name="Body" type="Area2D" parent="."]
unique_name_in_owner = true
visible = false
collision_layer = 3
collision_mask = 3

[node name="CollisionShape2D" type="CollisionShape2D" parent="Body"]
position = Vector2(-4.76837e-07, -3.72523e-09)
rotation = -1.56459
shape = SubResource("CircleShape2D_o028b")

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
unique_name_in_owner = true
path_max_distance = 50.0
debug_enabled = true

[node name="Movetimer" type="Timer" parent="."]
unique_name_in_owner = true
wait_time = 2.0
autostart = true

[node name="AttackTimer" type="Timer" parent="."]
unique_name_in_owner = true

[node name="StateChart" type="Node" parent="."]
unique_name_in_owner = true
script = ExtResource("3_u53yq")
metadata/_custom_type_script = "uid://couw105c3bde4"

[node name="CompoundState" type="Node" parent="StateChart"]
script = ExtResource("4_wcc3o")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateChart/CompoundState"]
script = ExtResource("5_4yoai")

[node name="ToApproach" type="Node" parent="StateChart/CompoundState/Idle"]
script = ExtResource("6_1wtkv")
to = NodePath("../../Approach")
event = &"enemie_entered"
delay_in_seconds = "0.0"

[node name="Approach" type="Node" parent="StateChart/CompoundState"]
script = ExtResource("5_4yoai")

[node name="ToIdle" type="Node" parent="StateChart/CompoundState/Approach"]
script = ExtResource("6_1wtkv")
to = NodePath("../../Idle")
event = &"enemie_exited"
delay_in_seconds = "0.0"

[node name="ToFight" type="Node" parent="StateChart/CompoundState/Approach"]
script = ExtResource("6_1wtkv")
to = NodePath("../../Fight")
event = &"enemy_fight"
delay_in_seconds = "0.0"

[node name="Fight" type="Node" parent="StateChart/CompoundState"]
script = ExtResource("5_4yoai")

[node name="ToDead" type="Node" parent="StateChart/CompoundState/Fight"]
script = ExtResource("6_1wtkv")
to = NodePath("../../Dead")
event = &"self_dead"
delay_in_seconds = "0.0"

[node name="ToApproach" type="Node" parent="StateChart/CompoundState/Fight"]
script = ExtResource("6_1wtkv")
to = NodePath("../../Approach")
event = &"re_approach"
delay_in_seconds = "0.0"

[node name="ToIdle" type="Node" parent="StateChart/CompoundState/Fight"]
script = ExtResource("6_1wtkv")
to = NodePath("../../Idle")
event = &"target_lost"
delay_in_seconds = "0.0"

[node name="Dead" type="Node" parent="StateChart/CompoundState"]
script = ExtResource("5_4yoai")

[connection signal="area_entered" from="DetectionArea" to="." method="_on_detection_area_area_entered"]
[connection signal="area_exited" from="DetectionArea" to="." method="_on_detection_area_area_exited"]
[connection signal="timeout" from="AttackTimer" to="." method="_on_attack_timer_timeout"]
[connection signal="state_entered" from="StateChart/CompoundState/Idle" to="." method="_on_idle_state_entered"]
[connection signal="state_processing" from="StateChart/CompoundState/Idle" to="." method="_on_idle_state_processing"]
[connection signal="state_entered" from="StateChart/CompoundState/Approach" to="." method="_on_approach_state_entered"]
[connection signal="state_processing" from="StateChart/CompoundState/Approach" to="." method="_on_approach_state_processing"]
[connection signal="child_entered_tree" from="StateChart/CompoundState/Approach/ToFight" to="." method="_on_to_fight_child_entered_tree"]
[connection signal="state_entered" from="StateChart/CompoundState/Fight" to="." method="_on_fight_state_entered"]
[connection signal="state_processing" from="StateChart/CompoundState/Fight" to="." method="_on_fight_state_processing"]
[connection signal="state_entered" from="StateChart/CompoundState/Dead" to="." method="_on_dead_state_entered"]
